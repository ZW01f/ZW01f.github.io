---
title: "APT37 - RokRat  "
classes: wide
header:
  teaser: /assets/images/malware-analysis/apt37/thumbnail.png
ribbon: DodgerBlue
description: "An in-depth analysis of APT37â€™s latest campaign leveraging fileless RokRat malware "
categories:
  - Malware Analysis
toc: true
---
# Meet APT37 Group 

APT37, also known as ScarCruft, Reaper, and Red Eyes, is a North Korean state-sponsored hacking group that has been active since 2012. Originally, its operations focused on public and private sectors within South Korea, though in 2017, it extended its targets to include Japan, Vietnam, the Middle East, and industries such as healthcare and manufacturing. By 2023, APT37 had shifted to phishing campaigns targeting users on both Windows and Android platforms.


The group is known for leveraging various attack vectors, including malicious LNK files spread via group chat platforms to infect victims.

# Technical in Points

- **Infection Vector**: The attack begins with phishing emails containing ZIP attachments that hide malicious LNK files, masquerading as documents related to North Korean affairs or trade agreements. When executed, the LNK file starts a multi-stage attack using batch scripts and PowerShell, finally having RokRat as the final payload.

- **Host Profiling**: RoTRat collects detailed system information, including the OS version, computer name, logged-in user, and executable path. It also retrieves hardware details, tracks system uptime, enumerates running processes and captures screenshots. This data is then exfiltrated to the Command-and-Control (C2) server.

- **C2 Communication**: RokRat abuses cloud services like pCloud, Yandex, and Dropbox as its Command-and-Control (C2) channels, using their APIs to send, download, and delete files. It also embeds OAuth tokens within its code to facilitate seamless communication with these services.

- **Command Execution**: RokRAT can execute commands on the infected system, allowing attackers to perform a wide range of activities, such as data exfiltration, system reconnaissance, and process termination. It can execute remote commands via cmd.exe, collect and upload files, scan system drives, delete specific files, and retrieve additional payloads from Command-and-Control (C2).

# Infection Flow

The infection starts with phishing emails that look critical, as attackers use real information from websites to make them seem more believable. These emails contain ZIP files with malicious LNK files disguised as documents. When executed, it launches the next stage of the attack.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/infection.png">
    <img src="/assets/images/malware-analysis/apt37/infection.png" alt="API Response Process">
  </a>
  <center><font size="3"><u>Figure</u>(1): <u>Infection Flow Diagram</u></font> </center> 
</p>

## Stage 1 - LNK file

The code embedded within the ``.lnk`` file executes commands that invoke PowerShell.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/lnk_0.png">
    <img src="/assets/images/malware-analysis/apt37/lnk_0.png" alt="API Response Process">
  </a>
  <center><font size="3"><u>Figure</u>(2): <u>LECmd output</u></font> </center> 
<br>
</p>

First, it checks if it's running from **System32** or **Program Files**. If so, it moves to the ``%temp%`` directory. It then uses a simple trick to read itself by searching for ``.lnk`` files with a size of ``0x0DD4B11F`` bytes.

[![](/assets/images/malware-analysis/apt37/ps_1.png)](/assets/images/malware-analysis/apt37/ps_1.png)
<br>

Once found, it extracts multiple payloads from the ``.lnk`` file and saves them in the ``%temp%`` directory.

[![](/assets/images/malware-analysis/apt37/ps_2.png)](/assets/images/malware-analysis/apt37/ps_2.png)
<br>

The extracted files are:
- At offset 0x111E,  extracts 0xAD36 bytes and saves it as ``.hwpx`` , which is executed immediately.
- At offset 0xBE54,  extracts 0xD9190 bytes and saves it as ``caption.dat``.
- At offset 0xE4FE4,  extracts 0x0636 bytes and saves it as ``elephant.dat``.
- At offset 0xE561A,  extracts 0x0147 bytes and saves it as ``sharkeba.bat``, which is then executed.

To automate the extraction process, I wrote a quick script.

```python 
import os
import sys
def extract_embedded_files(lnk_path, output_dir):
    try:
        if not os.path.exists(output_dir):
            os.makedirs(output_dir)
        with open(lnk_path, 'rb') as lnk_file:
            
            lnk_file.seek(0x0000111E)
            hwpx_data = lnk_file.read(0x0000AD36)
            hwpx_path = os.path.join(output_dir, "extracted.hwpx")
            with open(hwpx_path, 'wb') as f:
                f.write(hwpx_data)
            print(f"HWPX file extracted")
            
            lnk_file.seek(0x0000BE54)
            exe_data = lnk_file.read(0x000D9190)
            exe_path = os.path.join(output_dir, "caption.dat")
            with open(exe_path, 'wb') as f:
                f.write(exe_data)
            print(f"Caption.dat extracted")
            
            lnk_file.seek(0x000E4FE4)
            string_data = lnk_file.read(0x00000636)
            string_path = os.path.join(output_dir, "elephant.dat")
            with open(string_path, 'wb') as f:
                f.write(string_data)
            print(f"Elephant.dat extracted")
            
            lnk_file.seek(0x000E561A)
            bat_data = lnk_file.read(0x00000147)
            bat_path = os.path.join(output_dir, "sharke.bat")
            with open(bat_path, 'wb') as f:
                f.write(bat_data)
            print(f"Batch file extracted")
                    
    except :
        print(f"Error occured ")

def main():
    lnk_path = ''
    output_dir = ''
    extract_embedded_files(lnk_path, output_dir)

if __name__ == "__main__":
    main()
```

Finally, it deletes the original ``.lnk`` file to cover its tracks.

[![](/assets/images/malware-analysis/apt37/ps_3.png)](/assets/images/malware-analysis/apt37/ps_3.png)
<br>

## Stage 2 - The dropped files

### HWPX document


<p align="center">
  <a href="/assets/images/malware-analysis/apt37/vt_decoy.png">
    <img src="/assets/images/malware-analysis/apt37/vt_decoy.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(3): <u>The HWPX document on VT </u></font> </center> 
<br>
This is a decoy document to make victims think they have opened a normal file while the real attack runs in the background. It appears to be a public service record form, commonly used in South Korea for official recommendations and recognitions.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/decoy_file.png">
    <img src="/assets/images/malware-analysis/apt37/decoy_file.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(4): <u>content of HWPX document </u></font> </center> 

### shark.bat

Started by analyzing ``shark.bat``, which is extracted and executed. This batch script launches PowerShell in a minimized, hidden window. It then reads ``elephant.dat`` from the ``%temp%`` directory, loads it into memory, and executes it using ``Invoke-Command``.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/nex_1.png">
    <img src="/assets/images/malware-analysis/apt37/nex_1.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(5): <u>The used script</u></font> </center> 

### elephant.dat

Despite its name, this is another PowerShell script designed to load and execute a payload in memory. It reads an encrypted file **caption.dat** (the fourth extracted file) from the ``%temp%`` directory and decrypts it using **a single-byte XOR key 'd'** to obtain executable content.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/ps_2_1.png">
    <img src="/assets/images/malware-analysis/apt37/ps_2_1.png" alt="API Response Process">
  </a>
</p>

Once decrypted, the script loads the necessary functions from ``kernel32.dll`` to execute the payload in memory. It allocates memory and creates a thread to run the decrypted payload.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/ps_2_2.png">
    <img src="/assets/images/malware-analysis/apt37/ps_2_2.png" alt="API Response Process">
  </a>

</p>

## Stage 3 - shellcode 

The decrypted shellcode decrypts the PE file from the hardcoded encrypted data.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/shell_code.png">
    <img src="/assets/images/malware-analysis/apt37/shell_code.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(6): <u>The decrypted shellcode.</u></font> </center> 
<br>

The shellcode reads data from memory at offset **0x58B**, where the first byte is the XOR key, the next four bytes give the encrypted data length, and the rest is the encrypted PE file. It decrypts the PE by XORing each byte with the key, loads it into memory, resolves imports and executes.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/shellcode.png">
    <img src="/assets/images/malware-analysis/apt37/shellcode.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(7): <u>The structure of the encrypted data </u></font> </center> 
<br>
we can dump that decrypted PE file using this IDApython script . 
```python
def save_to_file(file_path, data):
    with open(file_path, 'wb') as file:
        file.write(data)

addr = 0x58B

xor_key = idc.get_bytes(addr, 1)  

data_size = idc.get_wide_dword(addr + 1)  # read 4-byte data size

enc_data = idc.get_bytes(addr + 5, data_size)  # get encrypted data

dec_data = bytes(b ^ xor_key for b in enc_data)

save_to_file('dump_file.bin', dec_data)

```
# Final payload - RotRAT 

The final payload is **RokRat**, a remote access Trojan (RAT) primarily used by the APT37 threat group. This sample was compiled in October 2024 and was previously seen in another attack in December 2024.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/vt.png">
    <img src="/assets/images/malware-analysis/apt37/vt.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(8): <u>Rokrat on VT.</u></font> </center> 
<br>

## Anti analysis

### Encrypted strings 
Rokrat uses two custom string decryption techniques to hide its strings.

One technique involves storing strings as stack strings, encrypted using a simple subtraction-based transformation using the first character as a key, which is subtracted from each subsequent character along with a fixed value (2048).

Another method encrypts strings by using the first byte as a key. Each character is processed two bytes at a time, with the key subtracted from each to get the original text.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/str_dec.png">
    <img src="/assets/images/malware-analysis/apt37/str_dec.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(9): <u>Encrypted algorithms used.</u></font> </center> 
<br>

Here is the full decrypted string list : 

<details style="color: #EEFFFF; font-family: monospace !default; font-size: 0.85em; background: #263238; border: 1px solid #263238; border-radius: 3px; padding: 10px; line-height: 1.8">
    <summary style="outline: none; cursor: pointer">
        <span style="color: darkgray">
            Expand to see more
        </span><br>
        &emsp; IsWow64Process <br>
        &emsp; C:\Program Files\VMware\VMware Tools\vmtoolsd.exe<br>
        &emsp; HARDWARE\DESCRIPTION\System<br>
    </summary>
    &emsp; â€¢ SystemBiosVersion <br>
    &emsp; â€¢ "del \"%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*.VBS\" \"%appdata%\\*.CMD\" \"%appdata%\\*.BAT\" \"%appdata%\\*01\" \"%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*.lnk\" \"%allusersprofile%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*.lnk\" /F /Q"<br>
    &emsp; â€¢ "del \"%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*.VBS\" \"%appdata%\\*.CMD\" \"%appdata%\\*.BAT\" \"%appdata%\\*01\" /F /Q"<br>
    &emsp; â€¢ "tasklist>>\"%temp%\\r.txt\" & echo == Startup ==>>\"%temp%\\r.txt\" & dir /a \"%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\">>\"%temp%\\r.txt\" & dir /a  \"%allusersprofile%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\">>\"%temp%\\r.txt\" & echo == Info ==>>\"%temp%\\r.txt\" & systeminfo>>\"%temp%\\r.txt\" & echo == Route ==>>\"%temp%\\r.txt\" & route print>>\"%temp%\\r.txt\" & echo == Ip ==>>\"%temp%\\r.txt\" & ipconfig /all>>\"%temp%\\r.txt\" & echo == arp ==>>\"%temp%\\r.txt"<br>
    &emsp; â€¢ echo OK >> "%temp%\r.txt"<br>
    &emsp; â€¢ echo BD >> "%temp%\r.txt"<br>
    &emsp; â€¢ %spid:%d,name:%s,path:%s%s<br>
    &emsp; â€¢ "SYSTEM\\CurrentControlSet\\Services\\mssmbios\\Data"<br>
</details>


### Anti-vm 

Rokrat detects the existence of VMware Tools through vmtoolsd.exe. It first checks whether the executable exists in its default installation path and then retrieves its version details. If the file is found and its metadata is successfully extracted, it is assumed to be running inside a VMware virtual machine.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/anti_vm.png">
    <img src="/assets/images/malware-analysis/apt37/anti_vm.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(10): <u>Anti vm used. </u></font> </center> 


### Detect sandbox 

The function creates and then deletes a random file in **C:\Windows**, a common technique in malware and sandbox detection to test file system write permissions or introduce execution delays .

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/random_file.png">
    <img src="/assets/images/malware-analysis/apt37/random_file.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(11): <u> Detect sandbox. </u></font> </center> 
<br>

Also, Rokrat checks for a debugger using IsDebuggerPresent.

## Gather host info

RoTRat gathers detailed information about the compromised system. It first retrieves the **system version** and determines whether the process is running under ``WOW64``. 

Also, it collects system-related details such as the **computer name**, **the logged-in username**, and the **full path of the executable**.

It retrieves extra system details from the registry and determines the systemâ€™s uptime in milliseconds, excluding sleep time.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/info_fun_1.png">
    <img src="/assets/images/malware-analysis/apt37/info_fun_1.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(12): <u>Gathered Information. </u></font> </center> 
<br>

It also extracts system details from the registry, including the **SystemBiosVersion**.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/gather_info_2.png">
    <img src="/assets/images/malware-analysis/apt37/gather_info_2.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(13): <u>Get hardware Info from registry. </u></font> </center>


### Process Enumeration 

RoTRat gathers details about running processes, including their Process ID (PID), executable name, and file path. The information is formatted as ``"%spid:%d,name:%s,path:%s%s"``, stored and prepared for exfiltration.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/collect_processes.png">
    <img src="/assets/images/malware-analysis/apt37/collect_processes.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(14): <u>Process Enumeration function. </u></font> </center> 

### Capture a screenshot.

RoTRat captures a screenshot, processes the image (converting it to JPEG), and prepares it for exfiltration.


<p align="center">
  <a href="/assets/images/malware-analysis/apt37/take_screenshot.png">
    <img src="/assets/images/malware-analysis/apt37/take_screenshot.png" alt="API Response Process">
  </a>
</p>


## C2 Communications 

RokRat abuses legitimate cloud services such as pCloud, Yandex, and Dropbox as command and control (C2) channels. By using these platforms' APIs, RokRat can seamlessly exfiltrate stolen data, download additional payloads, and execute commands, all while mixing into normal network traffic. Also, it features a test mode that lets it run on the local machine.

| Operation         | Cloud Provider | API  |
|------------------|---------------|-------------|
| **Upload File**  | Dropbox       | `https://content.dropboxapi.com/2/files/upload` |
|                  | Yandex Disk   | `https://cloud-api.yandex.net/v1/disk/resources/upload?path=%s&overwrite=%s` |
|                  | pCloud        | `https://api.pcloud.com/uploadfile?path=%s&filename=%s&nopartial=1` |
| **Download File**| Dropbox       | `https://content.dropboxapi.com/2/files/download` |
|                  | Yandex Disk   | `https://cloud-api.yandex.net/v1/disk/resources/download?path=%s` |
|                  | pCloud        | `https://api.pcloud.com/getfilelink?path=%s&forcedownload=1&skipfilename=1` |
| **List Folder**  | Dropbox       | `https://api.dropboxapi.com/2/files/list_folder` |
|                  | Yandex Disk   | `https://cloud-api.yandex.net/v1/disk/resources?path=%s&limit=500` |
|                  | pCloud        | `https://api.pcloud.com/listfolder?path=%s` |
| **Delete File**  | Dropbox       | `https://api.dropboxapi.com/2/files/delete` |
|                  | Yandex Disk   | `https://cloud-api.yandex.net/v1/disk/resources?path=%s&permanently=%s` |
|                  | pCloud        | `https://api.pcloud.com/deletefile?path=%s` |


It also contains OAuth tokens within its code to enable communication with these cloud services.

Mainly using pCloud for its Command-and-Control (C2) operations. It authenticates with pCloud via an HTTP request that contains a hardcoded OAuth token:  ```JINs7ZDb7OvfloXrYZt8wH7kZ7LjAjGKBckj4kTgWSBiDSVWF1fKX```

It also hides its HTTP traffic by spoofing its User-Agent string, making it appear as a legitimate Googlebot request:
```Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)```


<p align="center">
  <a href="/assets/images/malware-analysis/apt37/http_request_api.png">
    <img src="/assets/images/malware-analysis/apt37/http_request_api.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(15): <u>Example of Http request . </u></font> </center> 
<br>

RokRat uses a combination of XOR obfuscation and RSA encryption before exfiltrating data. It first uses XOR encryption using randomly generated keys to obfuscate the data, making it less recognizable. Then, it encrypts the obfuscated data using RSA, ensuring that only the attacker, who owns the private key, can decrypt it. 


## Commands 

RokRat retrieves encrypted commands from its Command-and-Control (C2) server, using AES-CBC mode for encryption. It then decrypts the commands locally and executes them on the system.

### command '0'

This command sets the sent data flag to 0 (false), meaning that data collection should stop.

### Command - 'i'

This command sets the sent data flag to 1 (true), meaning that the collected information is ready to be sent to the command and control (C2) server.

### Command - 'j' or 'b'

This creates a termination process, forcing the malware to stop running and exit.

### Command - 'd'

This command performs a deletion operation to remove different script and shortcut files from the Windows Startup folder and the AppData directory. It targets ``.VBS`` (VBScript), ``.CMD`` , ``.BAT`` (batch scripts), ``.LNK`` (shortcuts), and any additional files created during execution.

```bat
    del "%appdata%\Microsoft\Windows\Start Menu\Programs\Startup\*.VBS" 
    "%appdata%\*.CMD" 
    "%appdata%\*.BAT" 
    "%appdata%\*01" 
    "%appdata%\Microsoft\Windows\Start Menu\Programs\Startup\*.lnk" 
    "%allusersprofile%\Microsoft\Windows\Start Menu\Programs\Startup\*.lnk" /F /Q

```
Once the deletion is complete, the command starts a termination process to shut down the RAT.

### Command - 'f'

This command is similar to the previous one, but it does not target .lnk (shortcut) files.

```bat
del \"%appdata%\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\*.VBS\"\
   "%appdata%\\*.CMD\" \
   "%appdata%\\*.BAT\" \
   "%appdata%\\*01\" /F /Q"
```
Once the deletion is complete, the command also starts a termination process to shut down the RAT.

### Command - 'g'

This command simply resets the memory and erases it, making it ready for another operation.

### Command - 'h'

This command scans all logical drives, including fixed, removable, and network drives, listing their contents recursively and saving the results in a temporary file. The file is then uploaded to the command and control (C2) server before being deleted to remove any traces.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/command_0.png">
    <img src="/assets/images/malware-analysis/apt37/command_0.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(16): <u>function scans all logical drives. </u></font> </center> 
<br>


### Command - 'e'

This command executes a received instruction from the C2 server via cmd.exe, allowing remote execution of system commands.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/command_e.png">
    <img src="/assets/images/malware-analysis/apt37/command_e.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(17): <u>Command e. </u></font> </center> 
<br>

### Command - 'c'
This command receives a path from the C2 server and checks whether it's a file or a directory. If the path is a directory, the function reads its files, processes them, encrypts their contents, and then uploads them to the C2 cloud server.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/command_c_0.png">
    <img src="/assets/images/malware-analysis/apt37/command_c_0.png" alt="API Response Process">
  </a>
</p>


If the path is a file, a filtering is applied based on file extensions. When the filter is set to "**Normal**," it specifically targets document-related file types such as ``.XLS``, ``.DOC`` , ``.PPT``, ``.TXT``, ``.M4A``, ``.AMR``, ``.PDF``, and ``.HWP``. However, if the filter is set to "**All**," it collects and uploads files of any type.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/command_c_1.png">
    <img src="/assets/images/malware-analysis/apt37/command_c_1.png" alt="API Response Process">
  </a>
</p>

### Commands [1-9]

These commands download a payload and execute it:

**Download (Commands 1, 2, 5, 6):**

These commands fetch secondary payloads dynamically from attacker-specified URLs. The process involves opening an HTTP connection to the URL and downloading the data without any additional decryption.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/command_url.png">
    <img src="/assets/images/malware-analysis/apt37/command_url.png" alt="API Response Process">
  </a>
</p>
<center><font size="3"><u>Figure</u>(18): <u>Download file from internet. </u></font> </center> 
<br>


**Download (Commands 3, 4, 7, 8, 9):**

These commands download a payload from C2 cloud services. Once downloaded, the payload is decrypted, and its integrity is verified through checks.

**Execution (Commands 1, 2, 3, 4):**

In this case, the code checks if the download is successful. If it is, the code creates a new thread to execute the payload. If the execution is successful, it writes "**OK**" to a temporary text file ``(%temp%\r.txt)``. If the execution fails, it writes "**BD**" to the same file.

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/excute_using_thread.png">
    <img src="/assets/images/malware-analysis/apt37/excute_using_thread.png" alt="API Response Process">
  </a>
</p>


Additionally, a batch script is executed to gather system information, including : 
- A list of running processes
- Startup items
- System configuration
- Routing details

This information is saved into the same temporary text file **(r.txt)**, encrypted, and then exfiltrated to the C2 server. After exfiltration, the file is deleted .

<p align="center">
  <a href="/assets/images/malware-analysis/apt37/file_dow_1.png">
    <img src="/assets/images/malware-analysis/apt37/file_dow_1.png" alt="API Response Process">
  </a>
</p>

 
**Execution (Commands 5, 6, 7, 8, 9):**

In this case, it also checks if the download is successful. If it is, it constructs a file path. Then, it creates a temporary file named ``KB400928_doc.exe`` , writes the extracted data to it, and executes the file using ``ShellExecuteA``.


# YARA Rule 

```css
rule detct_RokRat
{
    meta:
        description = "Detects Rokrat payload using some of the hardcoded strings "
        author = "Mohamed Ezzat (@ZW01f)"
        hash1  = "09a4adef9a7374616851e5e2a7d9539e1b9808e153538af94ad1d6d73a3a1232"
        hash2  = "94159655fa0bfb1eff092835d8922d3e18ca5c73884fd0d8b78f42c8511047b6"
    strings:
      // apis used 
      $s0 = "https://api.pcloud.com/deletefile?path=%s"  wide
        $s1 = "https://api.dropboxapi.com/2/files/list_folder"  wide
        $s3 = "https://cloud-api.yandex.net/v1/disk/resources/upload?path=%s&overwrite=%s" wide 
        $s4 = "https://cloud-api.yandex.net/v1/disk/resources?path=%s&limit=500" wide
      $s5 = "https://cloud-api.yandex.net/v1/disk/resources?path=%s&permanently=%s" wide
      // file it use for download payloads . 
      $s6 = "KB400928_doc.exe"
      $s7 = "%04d%02d%02d %02d%02d%02d" wide
    condition:
        uint16(0) == 0x5A4D and all of ($s*) 
} 
```


<br>

# IoCs

| Stage      | Hash                                                              |
|------------|-----------------------------------------------------------------|
| Zip file    | cfc814a16547dd4e92607bd42d2722cc567492e88d2830d7d28a0cc20bf3950c |
| Lnk file    | 7df7ad7b88887a06b559cd453e7b65230d0cccff1a403328a521d8753000c6c9 |
| hwpx document    | 9d96e4816a59475768d461a71cecf20fd99215ce289ecae8c865cf45feeb8802 |
|  shark.bat | 5306582c8a24508b594fed478d5abaa5544389c86ba507d8ebf98c5c7edde451 |
|elephant.dat | 2b6928101efa6ededc7da18e7894866710c10794b8cbaf43b48c721e9731c41a |
|caption.dat       |6d790df4a2c81e104db10f5e47eb663ca520a456b1305e74f18b2f20758ea4e1|
|shellcode - stage 3    | 1c4cd06ebece62c796ea517bf26cc869fa71213d17e30feb0f91c8a4cfa7ef1b|   
|RokRat - final payload | 09a4adef9a7374616851e5e2a7d9539e1b9808e153538af94ad1d6d73a3a1232 |


# References 
- [APT-C-28 Group Launched New Cyber Attack With Fileless RokRat Malware](https://cybersecuritynews.com/apt-c-28-group-launched-new-cyber-attack-with-fileless-RokRat-malware/)

- [Threat Actor Profile: ScarCruft / APT37](https://socradar.io/threat-actor-profile-scarcruft-apt37/)
 
